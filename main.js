(()=>{"use strict";var e=function(e){if("Escape"===e.key){var n=document.querySelector(".popup_is-opened");t(n)}},t=function(t){document.removeEventListener("keydown",e),t.classList.remove("popup_is-opened")},n=function(t){document.addEventListener("keydown",e),t.classList.add("popup_is-opened")},r=document.querySelector("#card-template").content;function o(e,t){var n=t.profileId,o=t.onImageClick,i=t.onDeleteButtonClick,c=t.onLikeButtonClick,u=n===e.owner._id,a=r.cloneNode(!0);return a.querySelector(".card").dataset.id=e._id,a.querySelector(".card__title").textContent=e.name,function(e,t,n){var r=e.querySelector(".card__image");r.src=t.link,r.alt=t.name,r.addEventListener("click",(function(e){n(e,t)}))}(a,e,o),function(e,t,n,r){var o=e.querySelector(".card__like-button");t.likes.some((function(e){return e._id===r}))&&o.classList.add("card__like-button_is-active"),o.addEventListener("click",(function(e){n(e,t)})),e.querySelector(".card__like-counter").textContent=t.likes.length}(a,e,c,n),function(e,t,n){var r=e.querySelector(".card__delete-button");n?r.addEventListener("click",(function(e){n(e,t)})):r.remove()}(a,e,u?i:void 0),a}var i=document.querySelector(".popup_type_image"),c=i.querySelector(".popup__image"),u=i.querySelector(".popup__caption"),a=document.querySelector(".popup_type_delete-card"),l=a.querySelector(".popup__form"),s=l.querySelector("input[name=id]"),p=l.querySelector(".popup__card-name"),d=document.querySelector(".popup_type_change-avatar"),f=d.querySelector(".popup__form"),m=document.querySelector(".profile__avatar-change"),y=document.querySelector(".popup_type_edit"),v=y.querySelector(".popup__form"),_=document.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_new-card"),S=b.querySelector(".popup__form"),h=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),k=document.querySelector(".profile__avatar-image"),q=document.querySelector(".places__list");function E(e,t){return Array.from(e.querySelectorAll(t.inputSelector))}function L(e,t){var n=e.querySelector(t.submitButtonSelector);n.setAttribute("disabled","true"),n.setAttribute("aria-disabled","true")}function O(e,t){e.querySelectorAll(t.errorClass).forEach((function(e){e.textContent=""})),E(e,t).forEach((function(e){!function(e,t){e.value="",e.classList.remove(t.inputErrorClass),e.classList.remove(t.inputSuccessClass)}(e,t)})),L(e,t)}function j(e,t){!function(e,t){return E(e,t).some((function(e){return!e.validity.valid}))}(e,t)?function(e,t){var n=e.querySelector(t.submitButtonSelector);n.removeAttribute("disabled"),n.removeAttribute("aria-disabled")}(e,t):L(e,t)}function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){P(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e,t,n){return(t=function(e){var t=function(e){if("object"!=w(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==w(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-23".concat(e),x(x({},t),{},{headers:x(x({},t.headers),{},{authorization:"3b9917af-204b-4e7d-87f8-6130b9e329cc"})})).then((function(e){if(e.ok)return e.json();throw new Error("Ошибка: ".concat(e.status))}))}function D(e){return T("/cards/likes/".concat(e),{method:"PUT"})}function B(e){return T("/cards/likes/".concat(e),{method:"DELETE"})}function I(e,t){if(e){if("string"==typeof e)return M(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var N={formSelector:".popup__form",formLoadingClass:"popup__form_loading",inputSelector:".popup__input",inputSuccessClass:"popup__input_type_success",inputErrorClass:"popup__input_type_error",submitButtonSelector:".popup__button",errorClass:"popup__error"},J=function(e,t){c.setAttribute("src",t.link),c.setAttribute("alt",t.name),u.innerText=t.name,n(i)},H=function(e,t){var n=e.currentTarget.closest(".card"),r=n.querySelector(".card__like-button");(r.classList.contains("card__like-button_is-active")?B:D)(t._id).then((function(e){r.classList.toggle("card__like-button_is-active"),n.querySelector(".card__like-counter").textContent=e.likes.length})).catch((function(e){console.log("Что-то пошло не так",e)}))},U=function(e,t){s.value=t._id,p.textContent=t.name,n(a)};function V(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";e.classList.add(t.formLoadingClass),e.querySelector(t.submitButtonSelector).textContent=n}function z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";e.classList.remove(t.formLoadingClass),e.querySelector(t.submitButtonSelector).textContent=n}_.addEventListener("click",(function(){O(v,N);var e=v.elements,t=e.name,r=e.description;t.value=g.textContent,r.value=C.textContent,j(v,N),n(y)})),h.addEventListener("click",(function(){O(S,N),n(b)})),m.addEventListener("click",(function(){O(f,N),f.elements.link.value=k.src,j(f,N),n(d)})),l.addEventListener("submit",(function(e){e.preventDefault(),V(l,N,"Удаление...");var n,r=e.target.elements.id.value;(n=r,T("/cards/".concat(n),{method:"DELETE"})).then((function(){q.querySelector('.card[data-id="'.concat(r,'"]')).remove(),t(a)})).catch((function(e){console.log("При удалении карточки произошла ошибка",e)})).finally((function(){z(l,N,"Да")}))})),S.addEventListener("submit",(function(e){e.preventDefault(),V(S,N);var n,r=e.target.elements,i=r["place-name"],c=r.link;(n={name:i.value,link:c.value},T("/cards",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).then((function(e){var n=o(e,{profileId:e.owner._id,onDeleteButtonClick:U,onLikeButtonClick:H,onImageClick:J});q.prepend(n),t(b)})).catch((function(e){console.log("При добавлении карточки произошла ошибка",e)})).finally((function(){z(S,N)}))})),f.addEventListener("submit",(function(e){var n;e.preventDefault(),V(f,N),(n=e.target.elements.link.value,T("/users/me/avatar",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:n})})).then((function(e){k.src=e.avatar,t(d)})).catch((function(e){console.log("При изменении аватара произошла ошибка",e)})).finally((function(){z(f,N)}))})),v.addEventListener("submit",(function(e){e.preventDefault();var n,r=e.target.elements,o=r.name,i=r.description;V(v,N),(n={name:o.value,about:i.value},T("/users/me",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).then((function(e){g.textContent=e.name,C.textContent=e.about,t(y)})).catch((function(e){console.log("При обновлении данных произошла ошибка",e)})).finally((function(){z(v,N)}))})),document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated"),e.querySelector(".popup__close").addEventListener("click",(function(){t(e)})),e.addEventListener("mousedown",(function(n){n.target===n.currentTarget&&t(e)}))})),function(e){var t=e.formSelector;document.querySelectorAll(t).forEach((function(t){E(t,e).forEach((function(n){n.addEventListener("input",(function(n){var r=n.target;r.validity.patternMismatch?r.setCustomValidity(r.dataset.errorMsg):r.setCustomValidity(""),r.validity.valid?function(e,t){e.classList.add(t.inputSuccessClass),e.classList.remove(t.inputErrorClass),e.nextElementSibling.textContent=""}(r,e):function(e,t){e.classList.remove(t.inputSuccessClass),e.classList.add(t.inputErrorClass),e.nextElementSibling.textContent=e.validationMessage}(r,e),j(t,e)}))}))}))}(N),Promise.all([T("/users/me"),T("/cards")]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,c,u=[],a=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=i.call(n)).done)&&(u.push(r.value),u.length!==t);a=!0);}catch(e){l=!0,o=e}finally{try{if(!a&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return u}}(t,n)||I(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=r[0],c=r[1],u=i.name,a=i.about,l=i.avatar,s=i._id;g.textContent=u,C.textContent=a,k.src=l,q.append.apply(q,function(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||I(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(c.map((function(e){return o(e,{profileId:s,onDeleteButtonClick:U,onLikeButtonClick:H,onImageClick:J})}))))}))})();